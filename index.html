<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Workout Progress Tracker</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #00b894;
        --secondary: #2d3436;
        --accent: #fd79a8;
        --light: #dfe6e9;
        --dark: #212529;
        --warning: #fdcb6e;
        --info: #74b9ff;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .auth-container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        width: 100%;
        max-width: 400px;
      }

      .auth-header {
        background: var(--secondary);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .auth-header h1 {
        font-weight: 800;
        font-size: 2.5rem;
        margin: 0;
      }

      .auth-header h1 span {
        color: var(--primary);
      }

      .auth-body {
        padding: 30px;
      }

      .form-control {
        padding: 12px 15px;
        border-radius: 10px;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
        margin-bottom: 20px;
      }

      .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 0.25rem rgba(0, 184, 148, 0.25);
      }

      .btn-primary {
        background: var(--primary);
        border: none;
        padding: 12px 20px;
        font-weight: 600;
        border-radius: 10px;
        transition: all 0.3s ease;
        width: 80%;
      }

      .btn-primary:hover {
        background: #00a085;
        transform: translateY(-2px);
      }

      .auth-switch {
        text-align: center;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
        color: #6c757d;
      }

      .auth-switch a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
      }

      .auth-switch a:hover {
        text-decoration: underline;
      }

      .dashboard {
        display: none;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        width: 100%;
        max-width: 1200px;
        min-height: 90vh;
      }

      .dashboard-header {
        background: var(--secondary);
        color: white;
        padding: 25px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .dashboard-header h1 {
        font-weight: 800;
        font-size: 2rem;
        margin: 0;
      }

      .dashboard-header h1 span {
        color: var(--primary);
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-avatar {
        width: 45px;
        height: 45px;
        background: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.1rem;
      }

      .logout-btn {
        background: transparent;
        border: 2px solid var(--primary);
        color: var(--primary);
        padding: 10px 20px;
        border-radius: 50px;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .logout-btn:hover {
        background: var(--primary);
        color: white;
      }

      .nav-tabs {
        border-bottom: 2px solid #e9ecef;
        padding: 0 30px;
        background: #f8f9fa;
      }

      .nav-tabs .nav-link {
        border: none;
        color: var(--secondary);
        font-weight: 600;
        padding: 18px 25px;
        border-radius: 0;
        font-size: 0.95rem;
        transition: all 0.3s ease;
      }

      .nav-tabs .nav-link:hover {
        color: var(--primary);
        background-color: rgba(0, 184, 148, 0.05);
      }

      .nav-tabs .nav-link.active {
        background: transparent;
        color: var(--primary);
        border-bottom: 3px solid var(--primary);
      }

      .dashboard-body {
        padding: 35px;
      }

      .dashboard-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        border-left: 4px solid var(--primary);
        margin-bottom: 30px;
        transition: transform 0.3s ease;
      }

      .dashboard-card:hover {
        transform: translateY(-2px);
      }

      .card-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--secondary);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .card-title i {
        color: var(--primary);
        font-size: 1.3rem;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 20px;
        margin: 25px 0;
      }

      .stat-item {
        text-align: center;
        padding: 20px 15px;
        background: #f8f9fa;
        border-radius: 12px;
        border-left: 4px solid var(--primary);
        transition: all 0.3s ease;
      }

      .stat-item:hover {
        background: #e9ecef;
        transform: translateY(-2px);
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: 5px;
      }

      .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .exercise-item {
        padding: 20px;
        border: 1px solid #e9ecef;
        border-radius: 12px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
      }

      .exercise-item:hover {
        border-color: var(--primary);
        background: #f8f9fa;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      }

      .exercise-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .exercise-name {
        font-weight: 600;
        color: var(--secondary);
        font-size: 1.2rem;
      }

      .exercise-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .stat-box {
        text-align: center;
        padding: 15px 10px;
        background: white;
        border-radius: 10px;
        border: 1px solid #e9ecef;
        transition: all 0.3s ease;
      }

      .stat-box:hover {
        border-color: var(--primary);
        background: #f8f9fa;
      }

      .stat-value-sm {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 5px;
      }

      .stat-label-sm {
        color: #6c757d;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .btn-success {
        background: var(--primary);
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
      }

      .btn-warning {
        background: var(--warning);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
      }

      .btn-info {
        background: var(--info);
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
      }

      .btn-sm {
        padding: 8px 16px;
        font-size: 0.85rem;
        border-radius: 6px;
      }

      .form-select {
        border-radius: 10px;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        font-size: 0.95rem;
      }

      .workout-session {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid var(--info);
        transition: all 0.3s ease;
      }

      .workout-session:hover {
        background: #e9ecef;
        transform: translateX(5px);
      }

      .session-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .session-date {
        font-weight: 600;
        color: var(--secondary);
        font-size: 1.1rem;
      }

      .session-exercises {
        color: #6c757d;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .action-buttons {
        display: flex;
        gap: 12px;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .action-buttons .btn {
        flex: 1;
        min-width: 160px;
        padding: 12px 20px;
        font-size: 0.95rem;
      }

      .modal-header {
        background: var(--secondary);
        color: white;
        border-bottom: none;
        padding: 25px;
      }

      .modal-title {
        font-weight: 700;
        font-size: 1.3rem;
      }

      .modal-body {
        padding: 25px;
      }

      .modal-footer {
        border-top: 1px solid #e9ecef;
        padding: 20px 25px;
      }

      @media (max-width: 768px) {
        .dashboard-body {
          padding: 25px 20px;
        }

        .dashboard-header {
          padding: 20px;
          flex-direction: column;
          gap: 15px;
          text-align: center;
        }

        .nav-tabs {
          padding: 0 15px;
        }

        .nav-tabs .nav-link {
          padding: 15px 20px;
          font-size: 0.9rem;
        }

        .stats-grid {
          grid-template-columns: 1fr 1fr;
          gap: 15px;
        }

        .exercise-stats {
          grid-template-columns: 1fr 1fr;
          gap: 10px;
        }

        .action-buttons .btn {
          min-width: 100%;
        }

        .exercise-header {
          flex-direction: column;
          gap: 10px;
          align-items: flex-start;
        }

        .session-header {
          flex-direction: column;
          gap: 8px;
          align-items: flex-start;
        }
      }

      @media (max-width: 576px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }

        .exercise-stats {
          grid-template-columns: 1fr;
        }

        .dashboard-card {
          padding: 20px;
        }
      }

      .text-muted {
        color: #6c757d !important;
        font-style: italic;
      }

      .alert {
        border-radius: 10px;
        border: none;
        padding: 15px 20px;
        margin-bottom: 20px;
      }

      .demo-account {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        border-left: 3px solid var(--primary);
      }
    </style>
  </head>
  <body>
    <!-- Login Form -->
    <div class="auth-container" id="loginContainer">
      <div class="auth-header">
        <h1>FIT<span>PROGRESS</span></h1>
        <p>Workout Progress Tracker</p>
      </div>
      <div class="auth-body">
        <div class="alert alert-danger" id="loginError" style="display: none">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Username atau password salah!
        </div>
        <form id="loginForm">
          <div class="mb-3">
            <input
              type="text"
              class="form-control"
              id="loginUsername"
              placeholder="Username"
              required
            />
          </div>
          <div class="mb-3">
            <input
              type="password"
              class="form-control"
              id="loginPassword"
              placeholder="Password"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-sign-in-alt me-2"></i>Login
          </button>
        </form>
        <div class="auth-switch">
          Belum punya akun? <a href="#" id="showRegister">Daftar di sini</a>
        </div>
        <div class="demo-account">
          <small class="text-muted d-block mb-2">Akun Demo:</small>
          <small><strong>Username:</strong> demo</small><br />
          <small><strong>Password:</strong> demo123</small>
        </div>
      </div>
    </div>

    <!-- Register Form -->
    <div class="auth-container" id="registerContainer" style="display: none">
      <div class="auth-header">
        <h1>FIT<span>PROGRESS</span></h1>
        <p>Daftar Akun Baru</p>
      </div>
      <div class="auth-body">
        <div
          class="alert alert-success"
          id="registerSuccess"
          style="display: none"
        >
          <i class="fas fa-check-circle me-2"></i>
          Pendaftaran berhasil! Silakan login.
        </div>
        <div
          class="alert alert-danger"
          id="registerError"
          style="display: none"
        >
          <i class="fas fa-exclamation-triangle me-2"></i>
          Username sudah digunakan!
        </div>
        <form id="registerForm">
          <div class="mb-3">
            <input
              type="text"
              class="form-control"
              id="registerName"
              placeholder="Nama Lengkap"
              required
            />
          </div>
          <div class="mb-3">
            <input
              type="text"
              class="form-control"
              id="registerUsername"
              placeholder="Username"
              required
            />
          </div>
          <div class="mb-3">
            <input
              type="password"
              class="form-control"
              id="registerPassword"
              placeholder="Password"
              required
            />
          </div>
          <div class="mb-3">
            <label class="form-label">Fokus Latihan</label>
            <select class="form-select" id="registerFocus">
              <option value="strength">Strength & Power</option>
              <option value="hypertrophy">Muscle Building</option>
              <option value="endurance">Endurance</option>
              <option value="weight_loss">Weight Loss</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-user-plus me-2"></i>Daftar
          </button>
        </form>
        <div class="auth-switch">
          Sudah punya akun? <a href="#" id="showLogin">Login di sini</a>
        </div>
      </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
      <div class="dashboard-header">
        <h1>FIT<span>PROGRESS</span> TRACKER</h1>
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <div>
            <div id="userName">User</div>
            <small id="userFocus">Strength Training</small>
          </div>
          <button class="logout-btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt me-1"></i> Logout
          </button>
        </div>
      </div>

      <ul class="nav nav-tabs" id="dashboardTabs">
        <li class="nav-item">
          <a class="nav-link active" data-bs-toggle="tab" href="#progress"
            ><i class="fas fa-chart-line me-2"></i>Progress</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" data-bs-toggle="tab" href="#workout"
            ><i class="fas fa-dumbbell me-2"></i>Workout Hari Ini</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" data-bs-toggle="tab" href="#history"
            ><i class="fas fa-history me-2"></i>Riwayat</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" data-bs-toggle="tab" href="#exercises"
            ><i class="fas fa-dumbbell me-2"></i>Exercises</a
          >
        </li>
      </ul>

      <div class="dashboard-body">
        <div class="tab-content">
          <!-- Progress Tab -->
          <div class="tab-pane fade show active" id="progress">
            <div class="dashboard-card">
              <h3 class="card-title">
                <i class="fas fa-chart-line"></i> Progress Minggu Ini
              </h3>
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-value" id="weeklySessions">0</div>
                  <div class="stat-label">Sesi Latihan</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="weeklyVolume">0</div>
                  <div class="stat-label">Total Volume</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="streakDays">0</div>
                  <div class="stat-label">Hari Beruntun</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" id="prCount">0</div>
                  <div class="stat-label">PR Baru</div>
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <h3 class="card-title">
                <i class="fas fa-trophy"></i> Personal Records
              </h3>
              <div id="prList">
                <p class="text-muted">Belum ada PR tercatat</p>
              </div>
            </div>

            <div class="dashboard-card">
              <h3 class="card-title">
                <i class="fas fa-dumbbell"></i> Progress Exercises
              </h3>
              <div id="exerciseProgress">
                <p class="text-muted">Belum ada data progress</p>
              </div>
            </div>
          </div>

          <!-- Workout Tab -->
          <div class="tab-pane fade" id="workout">
            <div class="dashboard-card">
              <h3 class="card-title">
                <i class="fas fa-dumbbell"></i> Workout Hari Ini
              </h3>
              <div class="action-buttons">
                <button
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#addExerciseModal"
                >
                  <i class="fas fa-plus me-2"></i>Tambah Exercise
                </button>
                <button class="btn btn-success" id="completeWorkoutBtn">
                  <i class="fas fa-check me-2"></i>Selesaikan Workout
                </button>
              </div>
              <div id="todayWorkout">
                <p class="text-muted">Belum ada exercise untuk hari ini</p>
              </div>
            </div>

            <div class="dashboard-card">
              <h3 class="card-title">
                <i class="fas fa-clock"></i> Workout Terakhir
              </h3>
              <div id="lastWorkout">
                <p class="text-muted">Belum ada riwayat workout</p>
              </div>
            </div>
          </div>

          <!-- History Tab -->
          <div class="tab-pane fade" id="history">
            <div class="dashboard-card">
              <h3 class="card-title">
                <i class="fas fa-history"></i> Riwayat Workout
              </h3>
              <div id="workoutHistory">
                <p class="text-muted">Belum ada riwayat workout</p>
              </div>
            </div>
          </div>

          <!-- Exercises Tab -->
          <div class="tab-pane fade" id="exercises">
            <div class="dashboard-card">
              <h3 class="card-title">
                <i class="fas fa-dumbbell"></i> Exercise Library
              </h3>
              <div class="mb-4">
                <div class="row g-3">
                  <div class="col-md-6">
                    <select class="form-select" id="exerciseCategory">
                      <option value="all">Semua Kategori</option>
                      <option value="chest">Chest</option>
                      <option value="back">Back</option>
                      <option value="legs">Legs</option>
                      <option value="shoulders">Shoulders</option>
                      <option value="arms">Arms</option>
                      <option value="core">Core</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <input
                      type="text"
                      class="form-control"
                      id="exerciseSearch"
                      placeholder="Cari exercise..."
                    />
                  </div>
                </div>
              </div>
              <div id="exerciseLibrary">
                <div class="exercise-item">
                  <div class="exercise-header">
                    <div class="exercise-name">Bench Press</div>
                    <button
                      class="btn btn-primary btn-sm"
                      onclick="addExerciseToWorkout('Bench Press', 'chest')"
                    >
                      <i class="fas fa-plus me-1"></i>Tambah
                    </button>
                  </div>
                  <div class="exercise-stats">
                    <div class="stat-box">
                      <div class="stat-value-sm" id="benchPressPr">-</div>
                      <div class="stat-label-sm">PR Terbaru</div>
                    </div>
                    <div class="stat-box">
                      <div class="stat-value-sm" id="benchPressVolume">-</div>
                      <div class="stat-label-sm">Volume</div>
                    </div>
                  </div>
                </div>

                <div class="exercise-item">
                  <div class="exercise-header">
                    <div class="exercise-name">Squat</div>
                    <button
                      class="btn btn-primary btn-sm"
                      onclick="addExerciseToWorkout('Squat', 'legs')"
                    >
                      <i class="fas fa-plus me-1"></i>Tambah
                    </button>
                  </div>
                  <div class="exercise-stats">
                    <div class="stat-box">
                      <div class="stat-value-sm" id="squatPr">-</div>
                      <div class="stat-label-sm">PR Terbaru</div>
                    </div>
                    <div class="stat-box">
                      <div class="stat-value-sm" id="squatVolume">-</div>
                      <div class="stat-label-sm">Volume</div>
                    </div>
                  </div>
                </div>

                <div class="exercise-item">
                  <div class="exercise-header">
                    <div class="exercise-name">Deadlift</div>
                    <button
                      class="btn btn-primary btn-sm"
                      onclick="addExerciseToWorkout('Deadlift', 'back')"
                    >
                      <i class="fas fa-plus me-1"></i>Tambah
                    </button>
                  </div>
                  <div class="exercise-stats">
                    <div class="stat-box">
                      <div class="stat-value-sm" id="deadliftPr">-</div>
                      <div class="stat-label-sm">PR Terbaru</div>
                    </div>
                    <div class="stat-box">
                      <div class="stat-value-sm" id="deadliftVolume">-</div>
                      <div class="stat-label-sm">Volume</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Exercise Modal -->
    <div class="modal fade" id="addExerciseModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah Exercise</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addExerciseForm">
              <div class="mb-3">
                <label class="form-label">Nama Exercise</label>
                <input
                  type="text"
                  class="form-control"
                  id="exerciseName"
                  placeholder="Contoh: Bench Press"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Kategori</label>
                <select
                  class="form-select"
                  id="exerciseCategorySelect"
                  required
                >
                  <option value="chest">Chest</option>
                  <option value="back">Back</option>
                  <option value="legs">Legs</option>
                  <option value="shoulders">Shoulders</option>
                  <option value="arms">Arms</option>
                  <option value="core">Core</option>
                </select>
              </div>
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Sets</label>
                    <input
                      type="number"
                      class="form-control"
                      id="exerciseSets"
                      value="3"
                      min="1"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Reps</label>
                    <input
                      type="number"
                      class="form-control"
                      id="exerciseReps"
                      value="10"
                      min="1"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label class="form-label">Weight (kg)</label>
                    <input
                      type="number"
                      class="form-control"
                      id="exerciseWeight"
                      value="0"
                      min="0"
                      step="0.5"
                      required
                    />
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="fas fa-times me-1"></i>Batal
            </button>
            <button type="button" class="btn btn-primary" id="saveExerciseBtn">
              <i class="fas fa-save me-1"></i>Simpan
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // DOM Elements
      const loginContainer = document.getElementById("loginContainer");
      const registerContainer = document.getElementById("registerContainer");
      const dashboard = document.getElementById("dashboard");
      const loginForm = document.getElementById("loginForm");
      const registerForm = document.getElementById("registerForm");
      const showRegister = document.getElementById("showRegister");
      const showLogin = document.getElementById("showLogin");
      const logoutBtn = document.getElementById("logoutBtn");
      const loginError = document.getElementById("loginError");
      const registerSuccess = document.getElementById("registerSuccess");
      const registerError = document.getElementById("registerError");
      const saveExerciseBtn = document.getElementById("saveExerciseBtn");
      const completeWorkoutBtn = document.getElementById("completeWorkoutBtn");

      // Initialize users in localStorage if not exists
      function initializeUsers() {
        if (!localStorage.getItem("fitprogressUsers")) {
          const defaultUsers = [
            {
              name: "Demo User",
              username: "demo",
              password: "demo123",
              focus: "strength",
              joinDate: new Date().toISOString().split("T")[0],
              workouts: [],
              exercises: {},
              stats: {
                totalWorkouts: 0,
                totalVolume: 0,
                streakDays: 0,
                prCount: 0,
              },
              lastWorkoutDate: null,
              currentWorkout: {
                date: new Date().toISOString(),
                exercises: [],
              },
            },
          ];
          localStorage.setItem(
            "fitprogressUsers",
            JSON.stringify(defaultUsers)
          );
        }
      }

      // Get all users
      function getUsers() {
        return JSON.parse(localStorage.getItem("fitprogressUsers")) || [];
      }

      // Save users to localStorage
      function saveUsers(users) {
        localStorage.setItem("fitprogressUsers", JSON.stringify(users));
      }

      // Get current user data
      function getCurrentUser() {
        const currentUser = localStorage.getItem("currentUser");
        return currentUser ? JSON.parse(currentUser) : null;
      }

      // Update current user data
      function updateCurrentUser(user) {
        const users = getUsers();
        const userIndex = users.findIndex((u) => u.username === user.username);
        if (userIndex !== -1) {
          users[userIndex] = user;
          saveUsers(users);
          localStorage.setItem("currentUser", JSON.stringify(user));
          return true;
        }
        return false;
      }

      // Show login form
      function showLoginForm() {
        loginContainer.style.display = "block";
        registerContainer.style.display = "none";
        dashboard.style.display = "none";
        loginError.style.display = "none";
      }

      // Show register form
      function showRegisterForm() {
        loginContainer.style.display = "none";
        registerContainer.style.display = "block";
        dashboard.style.display = "none";
        registerSuccess.style.display = "none";
        registerError.style.display = "none";
      }

      // Show dashboard
      function showDashboard(user) {
        loginContainer.style.display = "none";
        registerContainer.style.display = "none";
        dashboard.style.display = "block";

        // Update user info
        document.getElementById("userAvatar").textContent = user.name
          .charAt(0)
          .toUpperCase();
        document.getElementById("userName").textContent = user.name;
        document.getElementById("userFocus").textContent = getFocusText(
          user.focus
        );

        // Load user data
        loadUserData(user);
      }

      // Get focus text
      function getFocusText(focus) {
        const focuses = {
          strength: "Strength Training",
          hypertrophy: "Muscle Building",
          endurance: "Endurance Training",
          weight_loss: "Weight Loss",
        };
        return focuses[focus] || focus;
      }

      // Load user data
      function loadUserData(user) {
        updateProgressStats(user);
        loadTodayWorkout(user);
        loadWorkoutHistory(user);
        loadExerciseProgress(user);
      }

      // Update progress stats
      function updateProgressStats(user) {
        const today = new Date();
        const oneWeekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);

        const weeklyWorkouts = user.workouts.filter(
          (w) => new Date(w.date) >= oneWeekAgo
        );
        const weeklyVolume = weeklyWorkouts.reduce((total, workout) => {
          return (
            total +
            workout.exercises.reduce(
              (sum, ex) => sum + ex.sets * ex.reps * ex.weight,
              0
            )
          );
        }, 0);

        document.getElementById("weeklySessions").textContent =
          weeklyWorkouts.length;
        document.getElementById("weeklyVolume").textContent = weeklyVolume;
        document.getElementById("streakDays").textContent =
          user.stats?.streakDays || 0;
        document.getElementById("prCount").textContent =
          user.stats?.prCount || 0;
      }

      // Load today's workout
      function loadTodayWorkout(user) {
        const todayWorkout = document.getElementById("todayWorkout");
        const currentWorkout = user.currentWorkout || { exercises: [] };

        if (
          !currentWorkout.exercises ||
          currentWorkout.exercises.length === 0
        ) {
          todayWorkout.innerHTML =
            '<p class="text-muted">Belum ada exercise untuk hari ini</p>';
          return;
        }

        const exercisesHtml = currentWorkout.exercises
          .map(
            (exercise, index) => `
                <div class="exercise-item">
                    <div class="exercise-header">
                        <div class="exercise-name">${exercise.name}</div>
                        <button class="btn btn-sm btn-danger" onclick="removeExercise(${index})">
                            <i class="fas fa-trash me-1"></i>Hapus
                        </button>
                    </div>
                    <div class="exercise-stats">
                        <div class="stat-box">
                            <div class="stat-value-sm">${exercise.sets}</div>
                            <div class="stat-label-sm">Sets</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value-sm">${exercise.reps}</div>
                            <div class="stat-label-sm">Reps</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value-sm">${
                              exercise.weight
                            }kg</div>
                            <div class="stat-label-sm">Weight</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value-sm">${
                              exercise.sets * exercise.reps * exercise.weight
                            }</div>
                            <div class="stat-label-sm">Volume</div>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");

        todayWorkout.innerHTML = exercisesHtml;
      }

      // Load workout history
      function loadWorkoutHistory(user) {
        const workoutHistory = document.getElementById("workoutHistory");
        const lastWorkout = document.getElementById("lastWorkout");

        if (!user.workouts || user.workouts.length === 0) {
          workoutHistory.innerHTML =
            '<p class="text-muted">Belum ada riwayat workout</p>';
          lastWorkout.innerHTML =
            '<p class="text-muted">Belum ada riwayat workout</p>';
          return;
        }

        // Last workout
        const lastWorkoutData = user.workouts[user.workouts.length - 1];
        const lastWorkoutHtml = `
                <div class="workout-session">
                    <div class="session-header">
                        <div class="session-date">${new Date(
                          lastWorkoutData.date
                        ).toLocaleDateString("id-ID")}</div>
                    </div>
                    <div class="session-exercises">
                        ${lastWorkoutData.exercises
                          .map(
                            (ex) =>
                              `${ex.name} (${ex.sets}x${ex.reps} - ${ex.weight}kg)`
                          )
                          .join(", ")}
                    </div>
                </div>
            `;
        lastWorkout.innerHTML = lastWorkoutHtml;

        // All history
        const historyHtml = user.workouts
          .slice()
          .reverse()
          .map(
            (workout) => `
                <div class="workout-session">
                    <div class="session-header">
                        <div class="session-date">${new Date(
                          workout.date
                        ).toLocaleDateString("id-ID")}</div>
                        <div class="text-muted">${
                          workout.exercises.length
                        } exercises</div>
                    </div>
                    <div class="session-exercises">
                        ${workout.exercises
                          .map(
                            (ex) =>
                              `${ex.name} (${ex.sets}x${ex.reps} - ${ex.weight}kg)`
                          )
                          .join(", ")}
                    </div>
                </div>
            `
          )
          .join("");

        workoutHistory.innerHTML = historyHtml;
      }

      // Load exercise progress
      function loadExerciseProgress(user) {
        const exerciseProgress = document.getElementById("exerciseProgress");
        const prList = document.getElementById("prList");

        if (!user.exercises || Object.keys(user.exercises).length === 0) {
          exerciseProgress.innerHTML =
            '<p class="text-muted">Belum ada data progress</p>';
          prList.innerHTML = '<p class="text-muted">Belum ada PR tercatat</p>';
          return;
        }

        // Update exercise library stats
        const commonExercises = ["Bench Press", "Squat", "Deadlift"];
        commonExercises.forEach((exercise) => {
          if (user.exercises[exercise]) {
            const pr = Math.max(
              ...user.exercises[exercise].map((w) => w.weight)
            );
            const volume = user.exercises[exercise].reduce(
              (sum, w) => sum + w.sets * w.reps * w.weight,
              0
            );

            document.getElementById(
              exercise.toLowerCase().replace(" ", "") + "Pr"
            ).textContent = pr + "kg";
            document.getElementById(
              exercise.toLowerCase().replace(" ", "") + "Volume"
            ).textContent = volume;
          }
        });

        // PR List
        const prs = [];
        for (const [exerciseName, workouts] of Object.entries(user.exercises)) {
          const maxWeight = Math.max(...workouts.map((w) => w.weight));
          const bestWorkout = workouts.find((w) => w.weight === maxWeight);
          prs.push({
            exercise: exerciseName,
            weight: maxWeight,
            date: bestWorkout.date,
          });
        }

        const prHtml = prs
          .sort((a, b) => b.weight - a.weight)
          .map(
            (pr) => `
                <div class="exercise-item">
                    <div class="exercise-header">
                        <div class="exercise-name">${pr.exercise}</div>
                        <div class="text-success fw-bold">${pr.weight}kg</div>
                    </div>
                    <div class="text-muted">
                        ${new Date(pr.date).toLocaleDateString("id-ID")}
                    </div>
                </div>
            `
          )
          .join("");

        prList.innerHTML =
          prHtml || '<p class="text-muted">Belum ada PR tercatat</p>';
      }

      // Add exercise to today's workout
      function addExerciseToWorkout(name, category) {
        const user = getCurrentUser();
        if (!user) {
          alert("Silakan login terlebih dahulu!");
          return;
        }

        if (!user.currentWorkout) {
          user.currentWorkout = {
            date: new Date().toISOString(),
            exercises: [],
          };
        }

        // Check if exercise already exists
        const existingIndex = user.currentWorkout.exercises.findIndex(
          (ex) => ex.name === name
        );
        if (existingIndex !== -1) {
          alert("Exercise sudah ada dalam workout hari ini!");
          return;
        }

        const exercise = {
          name: name,
          category: category,
          sets: 3,
          reps: 10,
          weight: 0,
        };

        user.currentWorkout.exercises.push(exercise);

        if (updateCurrentUser(user)) {
          loadTodayWorkout(user);
          alert("Exercise berhasil ditambahkan!");
        }
      }

      // Remove exercise from workout
      function removeExercise(index) {
        const user = getCurrentUser();
        if (!user || !user.currentWorkout) return;

        user.currentWorkout.exercises.splice(index, 1);

        if (updateCurrentUser(user)) {
          loadTodayWorkout(user);
        }
      }

      // Complete workout
      function completeWorkout() {
        const user = getCurrentUser();
        if (
          !user ||
          !user.currentWorkout ||
          user.currentWorkout.exercises.length === 0
        ) {
          alert("Tidak ada exercise dalam workout hari ini!");
          return;
        }

        // Add to workout history
        if (!user.workouts) user.workouts = [];
        user.workouts.push(user.currentWorkout);

        // Update exercise records
        if (!user.exercises) user.exercises = {};

        user.currentWorkout.exercises.forEach((exercise) => {
          if (!user.exercises[exercise.name]) {
            user.exercises[exercise.name] = [];
          }
          user.exercises[exercise.name].push({
            sets: exercise.sets,
            reps: exercise.reps,
            weight: exercise.weight,
            date: user.currentWorkout.date,
          });
        });

        // Update stats
        if (!user.stats) user.stats = {};
        user.stats.totalWorkouts = (user.stats.totalWorkouts || 0) + 1;

        // Update streak
        const today = new Date().toDateString();
        const lastWorkoutDate = user.lastWorkoutDate;

        if (!lastWorkoutDate) {
          user.stats.streakDays = 1;
        } else if (lastWorkoutDate === today) {
          // Already worked out today
        } else {
          const lastDate = new Date(lastWorkoutDate);
          const todayDate = new Date(today);
          const diffDays = (todayDate - lastDate) / (1000 * 60 * 60 * 24);

          if (diffDays === 1) {
            user.stats.streakDays = (user.stats.streakDays || 0) + 1;
          } else {
            user.stats.streakDays = 1;
          }
        }

        user.lastWorkoutDate = today;

        // Reset current workout
        user.currentWorkout = {
          date: new Date().toISOString(),
          exercises: [],
        };

        if (updateCurrentUser(user)) {
          loadUserData(user);
          alert("Workout berhasil diselesaikan!");
        }
      }

      // Event Listeners
      loginForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const username = document.getElementById("loginUsername").value;
        const password = document.getElementById("loginPassword").value;

        const users = getUsers();
        const user = users.find(
          (u) => u.username === username && u.password === password
        );

        if (user) {
          localStorage.setItem("currentUser", JSON.stringify(user));
          showDashboard(user);
          loginError.style.display = "none";
        } else {
          loginError.style.display = "block";
        }
      });

      registerForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const name = document.getElementById("registerName").value;
        const username = document.getElementById("registerUsername").value;
        const password = document.getElementById("registerPassword").value;
        const focus = document.getElementById("registerFocus").value;

        const users = getUsers();

        if (users.find((u) => u.username === username)) {
          registerError.style.display = "block";
          registerSuccess.style.display = "none";
          return;
        }

        const newUser = {
          name,
          username,
          password,
          focus,
          joinDate: new Date().toISOString().split("T")[0],
          workouts: [],
          exercises: {},
          stats: {
            totalWorkouts: 0,
            totalVolume: 0,
            streakDays: 0,
            prCount: 0,
          },
          lastWorkoutDate: null,
          currentWorkout: {
            date: new Date().toISOString(),
            exercises: [],
          },
        };

        users.push(newUser);
        saveUsers(users);

        registerSuccess.style.display = "block";
        registerError.style.display = "none";
        registerForm.reset();

        setTimeout(() => {
          showLoginForm();
        }, 2000);
      });

      logoutBtn.addEventListener("click", function () {
        localStorage.removeItem("currentUser");
        showLoginForm();
      });

      saveExerciseBtn.addEventListener("click", function () {
        const name = document.getElementById("exerciseName").value;
        const category = document.getElementById(
          "exerciseCategorySelect"
        ).value;
        const sets = parseInt(document.getElementById("exerciseSets").value);
        const reps = parseInt(document.getElementById("exerciseReps").value);
        const weight = parseInt(
          document.getElementById("exerciseWeight").value
        );

        if (name && sets && reps && weight >= 0) {
          addExerciseToWorkout(name, category);

          // Close modal
          const modal = bootstrap.Modal.getInstance(
            document.getElementById("addExerciseModal")
          );
          if (modal) {
            modal.hide();
          }
          document.getElementById("addExerciseForm").reset();
        } else {
          alert("Harap isi semua field dengan benar!");
        }
      });

      completeWorkoutBtn.addEventListener("click", completeWorkout);

      showRegister.addEventListener("click", function (e) {
        e.preventDefault();
        showRegisterForm();
      });

      showLogin.addEventListener("click", function (e) {
        e.preventDefault();
        showLoginForm();
      });

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function () {
        initializeUsers();

        const currentUser = getCurrentUser();
        if (currentUser) {
          showDashboard(currentUser);
        } else {
          showLoginForm();
        }
      });
    </script>
  </body>
</html>
